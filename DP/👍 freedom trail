class Solution {
    int n;
    int[][] dp;
    Map<Character, List<Integer>> pos = new HashMap<>();

    public int findRotateSteps(String ring, String key) {
        n = ring.length();
        dp = new int[n][key.length()];
        
        for (int[] row : dp)
            Arrays.fill(row, -1);

        // store all positions of each char in ring
        for (int i = 0; i < n; i++) {
            pos.computeIfAbsent(ring.charAt(i), x -> new ArrayList<>()).add(i);
        }

        return solve(0, 0, key);
    }

    int solve(int ringPos, int keyIdx, String key) {
        if (keyIdx == key.length()) return 0;

        if (dp[ringPos][keyIdx] != -1)
            return dp[ringPos][keyIdx];

        int ans = Integer.MAX_VALUE;

        for (int nextPos : pos.get(key.charAt(keyIdx))) {
            int diff = Math.abs(nextPos - ringPos);
            int rotate = Math.min(diff, n - diff);

            ans = Math.min(ans,
                    rotate + 1 + solve(nextPos, keyIdx + 1, key));
        }

        return dp[ringPos][keyIdx] = ans;
    }
}
